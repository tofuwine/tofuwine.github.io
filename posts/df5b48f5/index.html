<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java 9 æ–°ç‰¹æ€§ | Tofuwine's Blog</title>
<meta name=keywords content="Java 9,new feature"><meta name=description content="Java 9 æ–°ç‰¹æ€§ä»‹ç»"><meta name=author content="tofuwine"><link rel=canonical href=https://tofuwine.github.io/posts/df5b48f5/><meta name=google-site-verification content="ckyTuus1DUaw4_LZBZpYeGKqKWmtHFLEeqp1rsXNwZA"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><meta name=baidu-site-verification content="codeva-9WUKJrZrua"><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "d28b07fc964a45f4aeb37a3550910329"}'></script><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://tofuwine.github.io/images/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://tofuwine.github.io/images/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://tofuwine.github.io/images/favicon.svg><link rel=apple-touch-icon href=https://tofuwine.github.io/images/favicon.svg><link rel=mask-icon href=https://tofuwine.github.io/images/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://tofuwine.github.io/posts/df5b48f5/><noscript><style>#theme-toggle,#top-link{display:none}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><meta property="og:title" content="Java 9 æ–°ç‰¹æ€§"><meta property="og:description" content="Java 9 æ–°ç‰¹æ€§ä»‹ç»"><meta property="og:type" content="article"><meta property="og:url" content="https://tofuwine.github.io/posts/df5b48f5/"><meta property="article:section" content="topics"><meta property="article:published_time" content="2021-02-15T17:05:10+08:00"><meta property="article:modified_time" content="2021-02-15T17:05:10+08:00"><meta property="og:site_name" content="Tofuwine's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java 9 æ–°ç‰¹æ€§"><meta name=twitter:description content="Java 9 æ–°ç‰¹æ€§ä»‹ç»"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“‚ ä¸“é¢˜","item":"https://tofuwine.github.io/topics/"},{"@type":"ListItem","position":2,"name":"ğŸ–¥ï¸ è®¡ç®—æœºç¼–ç¨‹æŠ€æœ¯","item":"https://tofuwine.github.io/topics/programming/"},{"@type":"ListItem","position":3,"name":"Java 9 æ–°ç‰¹æ€§","item":"https://tofuwine.github.io/posts/df5b48f5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java 9 æ–°ç‰¹æ€§","name":"Java 9 æ–°ç‰¹æ€§","description":"Java 9 æ–°ç‰¹æ€§ä»‹ç»","keywords":["Java 9","new feature"],"articleBody":"Java 9 æ­£å¼å‘å¸ƒäº 2017 å¹´ 9 æœˆ 21 æ—¥ã€‚ä½œä¸º Java 8 ä¹‹å 3 å¹´åŠæ‰å‘å¸ƒçš„æ–°ç‰ˆæœ¬ï¼ŒJava 9 å¸¦æ¥äº†å¾ˆå¤šé‡å¤§çš„å˜åŒ–ã€‚å…¶ä¸­æœ€é‡è¦çš„æ”¹åŠ¨æ˜¯ Java å¹³å°æ¨¡å—ç³»ç»Ÿçš„å¼•å…¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–°ç‰¹æ€§ã€‚\nJava å¹³å°æ¨¡å—ç³»ç»Ÿ Java å¹³å°æ¨¡å—ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ Project Jigsawï¼ŒæŠŠæ¨¡å—åŒ–å¼€å‘å®è·µå¼•å…¥åˆ°äº† Java å¹³å°ä¸­ã€‚åœ¨å¼•å…¥äº†æ¨¡å—ç³»ç»Ÿä¹‹åï¼ŒJDK è¢«é‡æ–°ç»„ç»‡æˆ 94 ä¸ªæ¨¡å—ã€‚Java åº”ç”¨å¯ä»¥é€šè¿‡æ–°å¢çš„ jlink å·¥å…·ï¼Œåˆ›å»ºå‡ºåªåŒ…å«æ‰€ä¾èµ–çš„ JDK æ¨¡å—çš„è‡ªå®šä¹‰è¿è¡Œæ—¶é•œåƒã€‚è¿™æ ·å¯ä»¥æå¤§çš„å‡å°‘ Java è¿è¡Œæ—¶ç¯å¢ƒçš„å¤§å°ã€‚è¿™å¯¹äºç›®å‰æµè¡Œçš„ä¸å¯å˜åŸºç¡€è®¾æ–½çš„å®è·µæ¥è¯´ï¼Œé•œåƒçš„å¤§å°çš„å‡å°‘å¯ä»¥èŠ‚çœå¾ˆå¤šå­˜å‚¨ç©ºé—´å’Œå¸¦å®½èµ„æºã€‚\næ¨¡å—åŒ–å¼€å‘çš„å®è·µåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µã€‚Java å¼€å‘ç¤¾åŒºå·²ç»ä½¿ç”¨è¿™æ ·çš„æ¨¡å—åŒ–å®è·µæœ‰ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ã€‚ä¸»æµçš„æ„å»ºå·¥å…·ï¼ŒåŒ…æ‹¬ Apache Maven å’Œ Gradle éƒ½æ”¯æŒæŠŠä¸€ä¸ªå¤§çš„é¡¹ç›®åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­é¡¹ç›®ã€‚å­é¡¹ç›®ä¹‹é—´é€šè¿‡ä¸åŒçš„ä¾èµ–å…³ç³»ç»„ç»‡åœ¨ä¸€èµ·ã€‚æ¯ä¸ªå­é¡¹ç›®åœ¨æ„å»ºä¹‹åéƒ½ä¼šäº§ç”Ÿå¯¹åº”çš„ JAR æ–‡ä»¶ã€‚åœ¨ Java 9 ä¸­ï¼Œå·²æœ‰çš„è¿™äº›é¡¹ç›®å¯ä»¥å¾ˆå®¹æ˜“çš„å‡çº§è½¬æ¢ä¸º Java 9 æ¨¡å—ï¼Œå¹¶ä¿æŒåŸæœ‰çš„ç»„ç»‡ç»“æ„ä¸å˜ã€‚\nJava 9 æ¨¡å—çš„é‡è¦ç‰¹å¾æ˜¯åœ¨å…¶å·¥ä½œï¼ˆartifactï¼‰çš„æ ¹ç›®å½•ä¸­åŒ…å«ä¸€ä¸ªæè¿°æ¨¡å—çš„ module-info.class æ–‡ä»¶ã€‚å·¥ä»¶çš„æ ¼å¼å¯ä»¥æ˜¯ä¼ ç»Ÿçš„ JAR æ–‡ä»¶æˆ–æ˜¯ Java 9 æ–°å¢çš„ JMOD æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”±æ ¹ç›®å½•ä¸­çš„æºä»£ç æ–‡ä»¶ module-info.java ç¼–è¯‘è€Œæ¥ã€‚è¯¥æ¨¡å—å£°æ˜æ–‡ä»¶å¯ä»¥æè¿°æ¨¡å—çš„ä¸åŒç‰¹å¾ã€‚æ¨¡å—å£°æ˜æ–‡ä»¶ä¸­å¯ä»¥åŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š\næ¨¡å—å¯¼å‡ºçš„åŒ…ï¼šä½¿ç”¨ exports å¯ä»¥å£°æ˜æ¨¡å—å¯¹å…¶ä»–æ¨¡å—æ‰€å¯¼å‡ºçš„åŒ…ã€‚åŒ…ä¸­çš„ public å’Œ protected ç±»å‹ï¼Œä»¥åŠè¿™äº›ç±»å‹çš„ public å’Œ protected æˆå‘˜å¯ä»¥è¢«å…¶ä»–æ¨¡å—æ‰€è®¿é—®ã€‚æ²¡æœ‰å£°æ˜ä¸ºå¯¼å‡ºçš„åŒ…ç›¸å½“äºæ¨¡å—ä¸­çš„ç§æœ‰æˆå‘˜ï¼Œä¸èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚ æ¨¡å—çš„ä¾èµ–å…³ç³»ï¼šä½¿ç”¨ requires å¯ä»¥å£°æ˜æ¨¡å—å¯¹å…¶ä»–æ¨¡å—çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨ requires transitive å¯ä»¥æŠŠä¸€ä¸ªæ¨¡å—ä¾èµ–å£°æ˜ä¸ºä¼ é€’çš„ã€‚ä¼ é€’çš„æ¨¡å—ä¾èµ–å¯ä»¥è¢«ä¾èµ–å½“å‰æ¨¡å—çš„å…¶ä»–æ¨¡å—æ‰€è¯»å–ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—æ‰€å¯¼å‡ºçš„ç±»å‹çš„å‹æ„ä¸­åŒ…å«äº†æ¥è‡ªå®ƒæ‰€ä¾èµ–çš„æ¨¡å—çš„ç±»å‹ï¼Œé‚£ä¹ˆå¯¹è¯¥æ¨¡å—çš„ä¾èµ–åº”è¯¥å£°æ˜ä¸ºä¼ é€’çš„ã€‚ æœåŠ¡çš„æä¾›å’Œä½¿ç”¨ï¼šå¦‚æœä¸€ä¸ªæ¨¡å—ä¸­åŒ…å«äº†å¯ä»¥è¢« ServiceLocator å‘ç°çš„æœåŠ¡æ¥å£çš„å®ç°ï¼Œéœ€è¦ä½¿ç”¨ provides with è¯­å¥æ¥å£°æ˜å…·ä½“çš„å®ç°ç±»ï¼›å¦‚æœä¸€ä¸ªæ¨¡å—éœ€è¦ä½¿ç”¨æœåŠ¡æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ uses è¯­å¥æ¥å£°æ˜ã€‚ ä»£ç æ¸…å• 1 ä¸­ç»™å‡ºäº†ä¸€ä¸ªæ¨¡å—å£°æ˜æ–‡ä»¶çš„ç¤ºä¾‹ã€‚åœ¨è¯¥å£°æ˜æ–‡ä»¶ä¸­ï¼Œæ¨¡å— com.mycompany.sample å¯¼å‡ºäº† Java åŒ… com.mycompany.sampleã€‚è¯¥æ¨¡å—ä¾èµ–äºæ¨¡å— com.mycompany.commonã€‚è¯¥æ¨¡å—ä¹Ÿæä¾›äº†æœåŠ¡æ¥å£ com.mycompany.common.DemoService çš„å®ç°ç±» com.mycompany.sample.DemoServiceImplã€‚\næ¸…å•1. æ¨¡å—å£°æ˜ç¤ºä¾‹\njava module-info.java 1 2 3 4 5 module com.mycompany.sample { exports com.mycompany.sample; requires com.mycompany.common; provides com.mycompany.common.DemoService with com.mycompany.sample.DemoServiceImpl; } æ¨¡å—ç³»ç»Ÿä¸­å¢åŠ äº†æ¨¡å—è·¯å¾„çš„æ¦‚å¿µã€‚æ¨¡å—ç³»ç»Ÿåœ¨è§£ææ¨¡å—æ—¶ï¼Œä¼šä»æ¨¡å—è·¯å¾„ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ä¸ºäº†ä¿æŒä¸ä¹‹å‰ Java ç‰ˆæœ¬çš„å…¼å®¹æ€§ï¼ŒCLASSPATH ä¾ç„¶ä¿ç•™ã€‚æ‰€æœ‰çš„ç±»å‹åœ¨è¿è¡Œæ—¶éƒ½å±äºæŸä¸ªç‰¹å®šçš„æ¨¡å—ã€‚å¯¹äº CLASSPATH ä¸­åŠ è½½çš„ç±»å‹ï¼Œå®ƒä»¬å±äºå®ƒä»¬çš„ç±»åŠ è½½å™¨å¯¹åº”çš„æœªå‘½åæ¨¡å—ã€‚å¯ä»¥é€šè¿‡ Class çš„ getModule() æ–¹æ³•æ¥è·å–åˆ°è¡¨ç¤ºå…¶æ‰€åœ¨æ¨¡å—çš„ Module å¯¹è±¡ã€‚\nåœ¨ JVM å¯åŠ¨æ—¶ï¼Œä¼šä»åº”ç”¨çš„æ ¹æ¨¡å—å¼€å§‹ï¼Œæ ¹æ®ä¾èµ–å…³ç³»é€’å½’çš„è¿›è¡Œè§£æï¼Œç›´åˆ°å¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºä¾èµ–å…³ç³»çš„å›¾ã€‚å¦‚æœè§£æè¿‡ç¨‹ä¸­å‡ºç°æ‰¾ä¸åˆ°æ¨¡å—çš„æƒ…å†µï¼Œæˆ–æ˜¯åœ¨æ¨¡å—è·¯å¾„çš„åŒä¸€ä¸ªåœ°æ–¹æ‰¾åˆ°äº†åç§°ç›¸åŒçš„æ¨¡å—ï¼Œæ¨¡å—è§£æè¿‡ç¨‹ä¼šç»ˆæ­¢ï¼ŒJVM ä¹Ÿä¼šé€€å‡ºã€‚Java ä¹Ÿæä¾›äº†å“åº”çš„ API ä¸æ¨¡å—ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚\nJshell jshell æ˜¯ Java 9 æ–°å¢çš„ä¸€ä¸ªå®ç”¨å·¥å…·ã€‚jshell ä¸º Java å¢åŠ äº†ç±»ä¼¼ NodeJS å’Œ Python ä¸­è¯»å€¼-æ±‚å€¼-æ‰“å°å¾ªç¯ï¼ˆRead - Evaluation - Print Loopï¼‰ã€‚\nåœ¨ jshell ä¸­å¯ä»¥ç›´æ¥è¾“å…¥è¡¨è¾¾å¼å¹¶æŸ¥çœ‹æ‰§è¡Œç»“æœã€‚å½“éœ€è¦æµ‹è¯•ä¸€ä¸ªæ–¹æ³•çš„è¿è¡Œç»“æœï¼Œæˆ–æ˜¯å¿«é€Ÿçš„å¯¹è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼æ—¶ï¼Œjshell éƒ½éå¸¸å®ç”¨ã€‚\nåªéœ€è¦é€šè¿‡ jshell å‘½ä»¤å¯åŠ¨ jshellï¼Œç„¶åç›´æ¥è¾“å…¥è¡¨è¾¾å¼å³å¯ã€‚æ¯ä¸ªè¡¨è¾¾å¼çš„ç»“æœéƒ½ä¼šè¢«è‡ªåŠ¨ä¿å­˜ä¸‹æ¥ï¼Œä»¥æ•°å­—ç¼–å·ä½œä¸ºå¼•ç”¨ï¼Œç±»ä¼¼ $1 å’Œ $2 è¿™æ ·çš„åç§°ã€‚ å¯ä»¥åœ¨åç»­çš„è¡¨è¾¾å¼ä¸­å¼•ç”¨ä¹‹å‰è¯­å¥çš„è¿è¡Œç»“æœã€‚\nåœ¨ jshell ä¸­ï¼Œé™¤äº†è¡¨è¾¾å¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ›å»º Java ç±»å’Œæ–¹æ³•ã€‚jshell ä¹Ÿæœ‰åŸºæœ¬çš„ä»£ç å®ŒæˆåŠŸèƒ½ã€‚\nåœ¨ä»£ç æ¸…å•2ä¸­ï¼Œç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªæ–¹æ³• addã€‚\næ¸…å•2. åœ¨ jshell ä¸­æ·»åŠ æ–¹æ³•\njshell 1 jshell\u003e int add(int x, int y) { ...\u003e return x + y; ...\u003e } | created method add(int, int) æ¥ç€å°±å¯ä»¥åœ¨ jshell ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚ä»£ç æ¸…å•3æ‰€ç¤ºï¼š\næ¸…å•3. åœ¨ jshell ä¸­ä½¿ç”¨åˆ›å»ºçš„æ–¹æ³•\njshell 1 jshell\u003e add(1, 2) $19 ==\u003e 3 è¾“å…¥ /exit å¯ä»¥é€€å‡º jshellã€‚ é›†åˆã€Stream å’Œ Optional åœ¨é›†åˆä¸Šï¼ŒJava 9 å¢åŠ äº† List.of()ã€Set.of()ã€Map.of() å’Œ Map.ofEntries() ç­‰å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸å¯å˜é›†åˆï¼Œå¦‚ ä»£ç æ¸…å• 4 æ‰€ç¤ºã€‚\næ¸…å•4. åˆ›å»ºä¸å¯å˜é›†åˆ\njava 1 2 3 4 5 6 7 8 List.of(); List.of(\"Hello\", \"World\"); List.of(1, 2, 3); Set.of(); Set.of(\"Hello\", \"World\"); Set.of(1, 2, 3); Map.of(); Map.of(\"Hello\", 1, \"World\", 2); Stream ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³• ofNullableã€dropWhileã€takeWhile å’Œ iterateã€‚åœ¨ ä»£ç æ¸…å• 5 ä¸­ï¼Œæµä¸­åŒ…å«äº†ä» 1 åˆ° 5 çš„å…ƒç´ ã€‚æ–­è¨€æ£€æŸ¥å…ƒç´ æ˜¯å¦ä¸ºå¥‡æ•°ã€‚ç¬¬ä¸€ä¸ªå…ƒç´  1 è¢«åˆ é™¤ï¼Œç»“æœæµä¸­åŒ…å« 4 ä¸ªå…ƒç´ ã€‚\næ¸…å•5. Stream ä¸­çš„ dropWhile æ–¹æ³•ç¤ºä¾‹\njava 1 2 3 4 5 6 7 @Test public void testDropWhile() { final long count = Stream.of(1, 2, 3, 4, 5) .dropWhile(i -\u003e i % 2 != 0) .count(); assertEquals(4, count); } Collectors ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³• filtering å’Œ flatMappingã€‚åœ¨ ä»£ç æ¸…å•6 ä¸­ï¼Œå¯¹äºè¾“å…¥çš„ String æµï¼Œå…ˆé€šè¿‡ flatMapping æŠŠ String æ˜ å°„æˆ Integer æµï¼Œå†æŠŠæ‰€æœ‰çš„ Integer æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚\næ¸…å•6. Collectors çš„ flatMapping æ–¹æ³•ç¤ºä¾‹\njava 1 2 3 4 5 6 @Test public void testFlatMapping() { final Set\u003cInteger\u003e result = Stream.of(\"a\", \"ab\", \"abc\") .collect(Collectors.flatMapping(v -\u003e v.chars().boxed(), Collectors.toSet())); assertEquals(3, result.size()); } Optional ç±»ä¸­æ–°å¢äº† ifPresentOrElseã€or å’Œ stream ç­‰æ–¹æ³•ã€‚åœ¨ ä»£ç æ¸…å• 7 ä¸­ï¼ŒOptional æµä¸­åŒ…å« 3 ä¸ªå…ƒç´ ï¼Œå…¶ä¸­åªæœ‰ 2 ä¸ªæœ‰å€¼ã€‚åœ¨ä½¿ç”¨ flatMap ä¹‹åï¼Œç»“æœæµä¸­åŒ…å«äº† 2 ä¸ªå€¼ã€‚\næ¸…å• 7. Optional çš„ stream æ–¹æ³•ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 @Test public void testStream() { final long count = Stream.of( Optional.of(1), Optional.empty(), Optional.of(2) ).flatMap(Optional::stream) .count(); assertEquals(2, count); } è¿›ç¨‹ API Java 9 å¢åŠ äº† ProcessHandle æ¥å£ï¼Œå¯ä»¥å¯¹åŸç”Ÿè¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œå°¤å…¶é€‚åˆäºç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ã€‚\nåœ¨ä½¿ç”¨ ProcessBuilder æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ä¹‹åï¼Œå¯ä»¥é€šè¿‡ Process.toHandle() æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ª ProcessHandle å¯¹è±¡å®ä¾‹ã€‚ é€šè¿‡ ProcessHandle å¯ä»¥è·å–åˆ°ç”± ProcessHandle.Info è¡¨ç¤ºçš„è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å‘½ä»¤è¡Œå‚æ•°ã€å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å’Œå¯åŠ¨æ—¶é—´ç­‰ã€‚ ProcessHandle çš„ onExit() æ–¹æ³•è¿”å›ä¸€ä¸ª CompletableFuture å¯¹è±¡ï¼Œå¯ä»¥åœ¨è¿›ç¨‹ç»“æŸæ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„åŠ¨ä½œã€‚\nä»£ç æ¸…å•8 ä¸­ç»™å‡ºäº†è¿›ç¨‹ API çš„ä½¿ç”¨ç¤ºä¾‹ã€‚\næ¸…å•8. è¿›ç¨‹ API ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 final ProcessBuilder processBuilder = new ProcessBuilder(\"top\").inheritIO(); final ProcessHandle processHandle = processBuilder.start().toHandle(); processHandle.onExit().whenCompleteAsync((handle, throwable) -\u003e { if (throwable == null) { System.out.println(handle.pid()); } else { throwable.printStackTrace(); } }); å¹³å°æ—¥å¿— API å’Œ æœåŠ¡ Java 9 å…è®¸ä¸º JDK å’Œåº”ç”¨é…ç½®åŒæ ·çš„æ—¥å¿—å®ç°ã€‚æ–°å¢çš„ System.LoggerFinder ç”¨æ¥ç®¡ç† JDK ä½¿ç”¨çš„æ—¥å¿—è®°å½•å™¨å®ç°ã€‚\nJVM åœ¨è¿è¡Œæ—¶åªæœ‰ä¸€ä¸ªç³»ç»ŸèŒƒå›´çš„ LoggerFinder å®ä¾‹ã€‚LoggerFinder é€šè¿‡æœåŠ¡æŸ¥æ‰¾æœºåˆ¶æ¥åŠ è½½æ—¥å¿—è®°å½•å™¨å®ç°ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒJDK ä½¿ç”¨ java.logging æ¨¡å—ä¸­çš„ java.util.logging å®ç°ã€‚é€šè¿‡ LoggerFinder çš„ getLogger() æ–¹æ³•å°±å¯ä»¥è·å–åˆ°è¡¨ç¤ºæ—¥å¿—è®°å½•å™¨çš„ System.Logger å®ç°ã€‚ åº”ç”¨åŒæ ·å¯ä»¥ä½¿ç”¨ System.Logger æ¥è®°å½•æ—¥å¿—ã€‚è¿™æ ·å°±ä¿è¯äº† JDK å’Œåº”ç”¨ä½¿ç”¨åŒæ ·çš„æ—¥å¿—å®ç°ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ System.LoggerFinder å®ç°æ¥è®© JDK å’Œåº”ç”¨ä½¿ç”¨ SLF4J ç­‰å…¶ä»–æ—¥å¿—è®°å½•æ¡†æ¶ã€‚\nä»£ç æ¸…å•9 ä¸­ç»™å‡ºäº†å¹³å°æ—¥å¿— API çš„ä½¿ç”¨ç¤ºä¾‹ã€‚\næ¸…å• 9. ä½¿ç”¨å¹³å°æ—¥å¿— API\njava 1 2 3 4 5 6 7 8 9 10 import java.lang.System.Logger; import java.lang.System.Logger.Level; public class Main { private static final Logger LOGGER = System.getLogger(\"Main\"); public static void main(final String[] args) { LOGGER.log(Level.INFO, \"Run!\"); } } ååº”å¼æµï¼ˆReactive Streamsï¼‰ ååº”å¼ç¼–ç¨‹çš„æ€æƒ³æœ€è¿‘å¾—åˆ°äº†å¹¿æ³›çš„æµè¡Œã€‚åœ¨ Java å¹³å°ä¸Šæœ‰æµè¡Œçš„ååº”å¼åº“ RxJava å’Œ Reactorã€‚\nååº”å¼æµè§„èŒƒçš„å‡ºå‘ç‚¹æ˜¯æä¾›ä¸€ä¸ªå¸¦éé˜»å¡è´Ÿå‹ï¼ˆnon-blocking backpressureï¼‰çš„å¼‚å¸¸æµå¤„ç†è§„èŒƒã€‚ååº”å¼æµè§„èŒƒçš„æ ¸å¿ƒæ¥å£å·²ç»æ·»åŠ åˆ°äº† Java 9 ä¸­çš„ java.util.concurrent.Flow ç±»ä¸­ã€‚\nFlow ä¸­åŒ…å«äº† Flow.Publisherã€Flow.Subscriberã€Flow.Subscription å’Œ Flow.Processor ç­‰ 4 ä¸ªæ ¸å¿ƒæ¥å£ã€‚Java 9 è¿˜æä¾›äº† SubmissionPublisher ä½œä¸º Flow.Publisher çš„ä¸€ä¸ªå®ç°ã€‚\nRxJava 2 å’Œ Reactor éƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ Flow ç±»çš„æ ¸å¿ƒæ¥å£è¿›è¡Œäº’æ“ä½œã€‚\nå˜é‡å¥æŸ„ å˜é‡å¥æŸ„æ˜¯ä¸€ä¸ªå˜é‡æˆ–ä¸€ç»„å˜é‡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬é™æ€åŸŸï¼Œéé™æ€åŸŸï¼Œæ•°ç»„å…ƒç´ å’Œå †å¤–æ•°æ®ç»“æ„ä¸­çš„ç»„æˆéƒ¨åˆ†ç­‰ã€‚å˜é‡å¥æŸ„çš„å«ä¹‰ç±»ä¼¼äºå·²æœ‰çš„æ–¹æ³•å¥æŸ„ã€‚\nå˜é‡å¥æŸ„ç”± Java ç±» java.lang.invoke.VarHandle æ¥è¡¨ç¤ºã€‚å¯ä»¥ä½¿ç”¨ç±» java.lang.invoke.MethodHandles.Lookup ä¸­é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»º VarHandle å¯¹è±¡ã€‚\né€šè¿‡å˜é‡å¥æŸ„ï¼Œå¯ä»¥åœ¨å˜é‡ä¸Šè¿›è¡Œå„ç§æ“ä½œã€‚è¿™äº›æ“ä½œç§°ä¸ºè®¿é—®æ¨¡å¼ã€‚ä¸åŒçš„è®¿é—®æ¨¡å¼å°¤å…¶åœ¨å†…å­˜æ’åºä¸Šçš„ä¸åŒè¯­ä¹‰ã€‚\nç›®å‰ä¸€å…±æœ‰ 31 ç§è®¿é—®æ¨¡å¼ï¼Œè€Œæ¯ç§è®¿é—®æ¨¡å¼éƒ½åœ¨ VarHandle ä¸­æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¯¹å˜é‡è¿›è¡Œè¯»å–ã€å†™å…¥ã€åŸå­æ›´æ–°ã€æ•°å€¼åŸå­æ›´æ–°å’Œæ¯”ç‰¹ä½åŸå­æ“ä½œç­‰ã€‚VarHandle è¿˜å¯ä»¥ç”¨æ¥è®¿é—®æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ ï¼Œä»¥åŠæŠŠ byte[] æ•°ç»„å’Œ ByteBuffer å½“æˆæ˜¯ä¸åŒåŸå§‹ç±»å‹çš„æ•°ç»„æ¥è®¿é—®ã€‚\nåœ¨ ä»£ç æ¸…å•10 ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è®¿é—® HandleTarget ç±»ä¸­çš„åŸŸ count çš„å˜é‡å¥æŸ„ï¼Œå¹¶åœ¨å…¶ä¸Šè¿›è¡Œè¯»å–æ“ä½œã€‚\næ¸…å• 10. å˜é‡å¥æŸ„ä½¿ç”¨ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import org.junit.Before; import org.junit.Test; import java.lang.invoke.MethodHandles; import java.lang.invoke.VarHandle; import static org.junit.Assert.assertEquals; public class HandleTarget { public int count = 1; } public class VarHandleTest { private HandleTarget handleTarget = new HandleTarget(); private VarHandle varHandle; @Before public void setUp() throws Exception { this.handleTarget = new HandleTarget(); this.varHandle = MethodHandles .lookup() .findVarHandle(HandleTarget.class, \"count\", int.class); } @Test public void testGet() throws Exception { assertEquals(1, this.varHandle.get(this.handleTarget)); assertEquals(1, this.varHandle.getVolatile(this.handleTarget)); assertEquals(1, this.varHandle.getOpaque(this.handleTarget)); assertEquals(1, this.varHandle.getAcquire(this.handleTarget)); } } æ”¹å˜æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰ ç±» java.lang.invoke.MethodHandles å¢åŠ äº†æ›´å¤šçš„é™æ€æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„æ–¹æ³•å¥æŸ„ã€‚\narrayConstructorï¼šåˆ›å»ºæŒ‡å®šç±»å‹çš„æ•°ç»„ arrayLengthï¼šè·å–æŒ‡å®šç±»å‹çš„æ•°ç»„çš„å¤§å° varHandleInvoker å’Œ varHandleExactInvokerï¼šè°ƒç”¨ VarHandle ä¸­çš„è®¿é—®æ¨¡å¼æ–¹æ³• zeroï¼šè¿”å›ä¸€ä¸ªç±»å‹çš„é»˜è®¤å€¼ emptyï¼šè¿”å› MethodType çš„è¿”å›å€¼ç±»å‹çš„é»˜è®¤å€¼ loopã€countedLoopã€iteratedLoopã€whileLoop å’Œ doWhileLoopï¼šåˆ›å»ºä¸åŒç±»å‹çš„å¾ªç¯ï¼ŒåŒ…æ‹¬ for å¾ªç¯ã€while å¾ªç¯ å’Œ do-while å¾ªç¯ã€‚ tryFinallyï¼šå¯¹æ–¹æ³•å¥æŸ„çš„è°ƒç”¨å°è£…åœ¨ try-finally è¯­å¥ä¸­ã€‚ åœ¨ ä»£ç æ¸…å• 11 ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ iteratedLoop æ¥åˆ›å»ºä¸€ä¸ªéå† String ç±»å‹è¿­ä»£å™¨çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶è®¡ç®—æ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦çš„æ€»å’Œã€‚\næ¸…å• 11. å¾ªç¯æ–¹æ³•å¥æŸ„ä½¿ç”¨ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import org.junit.Test; import java.lang.invoke.MethodHandle; import java.lang.invoke.MethodHandles; import java.lang.invoke.MethodType; import java.util.Iterator; import java.util.List; import static org.junit.Assert.assertEquals; public class IteratedLoopTest { static int body(final int sum, final String value) { return sum + value.length(); } @Test public void testIteratedLoop() throws Throwable { final MethodHandle iterator = MethodHandles.constant( Iterator.class, List.of(\"a\", \"bc\", \"def\").iterator() ); final MethodHandle init = MethodHandles.zero(int.class); final MethodHandle body = MethodHandles .lookup() .findStatic( IteratedLoopTest.class, \"body\", MethodType.methodType( int.class, int.class, String.class ) ); final MethodHandle iteratedLoop = MethodHandles.iteratedLoop(iterator, init, body); assertEquals(6, iteratedLoop.invoke()); } } å¹¶å‘ åœ¨å¹¶å‘æ–¹é¢ï¼Œç±» CompletableFuture ä¸­å¢åŠ äº†å‡ ä¸ªæ–°çš„æ–¹æ³•ã€‚\ncompleteAsync ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥è·å–ç»“æœå¹¶å®Œæˆè¯¥ CompletableFutureã€‚ orTimeout åœ¨ Completable Future æ²¡æœ‰åœ¨ç»™å®šçš„è¶…æ—¶æ—¶é—´ä¹‹å‰å®Œæˆï¼Œä½¿ç”¨ Timeout Exception å¼‚å¸¸æ¥å®Œæˆ CompletableFutureã€‚ completeOnTimeout ä¸ orTimeout ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒåœ¨è¶…æ—¶æ—¶ä½¿ç”¨ç»™å®šçš„å€¼æ¥å®Œæˆ Completable Futureã€‚ æ–°çš„ Thread.onSpinWait æ–¹æ³•åœ¨å½“å‰çº¿ç¨‹éœ€è¦ä½¿ç”¨å¿™å¾ªç¯æ¥ç­‰å¾…æ—¶ï¼Œå¯ä»¥æé«˜ç­‰å¾…çš„æ•ˆç‡ã€‚ Nashorn Nashorn æ˜¯ Java 8 ä¸­å¼•å…¥çš„æ–°çš„ JavaScript å¼•æ“ã€‚ Java 9 ä¸­çš„ Nashorn å·²ç»å®ç°äº†ä¸€äº› ECMAScript 6 è§„èŒƒä¸­çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ¨¡æ¿å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶å­—é¢é‡ã€è¿­ä»£å™¨ å’Œ for..of å¾ªç¯ å’Œ ç®­å¤´å‡½æ•° ç­‰ã€‚\nNashorn è¿˜æä¾›äº† API æŠŠ ECMAScript æºä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰ï¼Œå¯ä»¥ç”¨æ¥å¯¹ ECMAScript æºä»£ç è¿›è¡Œåˆ†æã€‚\nI/O æµæ–°ç‰¹æ€§ ç±» java.io.InputStream ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³•æ¥è¯»å–å’Œå¤åˆ¶ InputStream ä¸­åŒ…å«çš„æ•°æ®ã€‚\nreadAllBytesï¼šè¯»å– InputStream ä¸­çš„æ‰€æœ‰å‰©ä½™å­—èŠ‚ã€‚ readNBytesï¼šä» InputStream ä¸­è¯»å–æŒ‡å®šæ•°é‡çš„å­—èŠ‚åˆ°æ•°ç»„ä¸­ã€‚ transferToï¼šè¯»å– InputStream ä¸­çš„å…¨éƒ¨å­—èŠ‚å¹¶å†™å…¥åˆ°æŒ‡å®šçš„ OutputStream ä¸­ã€‚ ä»£ç æ¸…å• 12 ä¸­ç»™å‡ºäº†è¿™äº›æ–°æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹ã€‚\næ¸…å• 12. InputStream ä¸­çš„æ–°æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 import org.junit.Before; import org.junit.Test; import java.io.ByteArrayOutputStream; import java.io.InputStream; import static org.junit.Assert.assertEquals; public class TestInputStream { private InputStream inputStream; private static final String CONTENT = \"Hello World\"; @Before public void setUp() throws Exception { this.inputStream = TestInputStream.class.getResourceAsStream(\"/input.text\"); } @Test public void testReadAllBytes() throws Exception { final String content = new String(this.inputStream.readAllBytes()); assertEquals(CONTENT, content); } @Test public void testReadNBytes() throws Exception { final byte[] data = new byte[5]; this.inputStream.readNBytes(data, 0, 5); assertEquals(\"Hello\", new String(data)); } @Test public void testTransferTo() throws Exception { final ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); this.inputStream.transferTo(outputStream); assertEquals(CONTENT, outputStream.toString()); } } ObjectInputFilter å¯ä»¥å¯¹ ObjectInputStream ä¸­åŒ…å«çš„å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œæ¥ç¡®ä¿å…¶ä¸­åŒ…å«çš„æ•°æ®æ˜¯åˆæ³•çš„ã€‚å¯ä»¥ä½¿ç”¨ ObjectInputSteam çš„æ–¹æ³• setObjectInputFilter æ¥è®¾ç½®ã€‚\nObjectInputFilter åœ¨è¿›è¡Œæ£€æŸ¥æ—¶ï¼Œå¯ä»¥æ£€æŸ¥å¦‚å¯¹è±¡å›¾çš„æœ€å¤§æ·±åº¦ã€å¯¹è±¡å¼•ç”¨çš„æœ€å¤§æ•°é‡ã€è¾“å…¥æµä¸­çš„æœ€å¤§å­—èŠ‚æ•°å’Œæ•°ç»„çš„æœ€å¤§é•¿åº¦ç­‰é™åˆ¶ï¼Œä¹Ÿå¯ä»¥åŒ…å«çš„ç±»çš„åç§°è¿›è¡Œé™åˆ¶ã€‚\næ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½ Java 9 æ–°å¢äº† 4 ä¸ª SHA-3 å“ˆå¸Œç®—æ³•ï¼ŒSHA3-224ã€SHA3-256ã€SHA3-384 å’Œ SHA3-512ã€‚å¦å¤–ä¹Ÿå¢åŠ äº†é€šè¿‡ java.security.SecureRandom ç”Ÿæˆä½¿ç”¨ DRBG ç®—æ³•çš„å¼ºéšæœºæ•°ã€‚\nä»£ç æ¸…å• 13 ä¸­ç»™å‡ºäº† SHA-3 å“ˆå¸Œç®—æ³•çš„ä½¿ç”¨ç¤ºä¾‹ã€‚\næ¸…å• 13. SHA-3 å“ˆå¸Œç®—æ³•ä½¿ç”¨ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 11 import org.apache.commons.codec.binary.Hex; import java.security.MessageDigest; import java.security.NoSuchAlgorithmException; public class SHA3 { public static void main(final String[] args) throws NoSuchAlgorithmException { final MessageDigest instance = MessageDigest.getInstance(\"SHA3-224\"); final byte[] digest = instance.digest(\"\".getBytes()); System.out.println(Hex.encodeHexString(digest)); } } ç”¨æˆ·ç•Œé¢ ç±» java.awt.Desktop å¢åŠ äº†æ–°çš„ä¸æ¡Œé¢è¿›è¡Œäº’åŠ¨çš„èƒ½åŠ›ã€‚\nå¯ä»¥ä½¿ç”¨ addAppEventListener æ–¹æ³•æ¥æ·»åŠ ä¸åŒåº”ç”¨äº‹ä»¶çš„ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬åº”ç”¨å˜ä¸ºå‰å°åº”ç”¨ã€åº”ç”¨éšè—æˆ–æ˜¾ç¤ºã€å±å¹•å’Œç³»ç»Ÿè¿›å…¥ä¼‘çœ ä¸å”¤é†’ã€ä»¥åŠ ç”¨æˆ·ä¼šè¯çš„å¼€å§‹å’Œç»ˆæ­¢ç­‰ã€‚è¿˜å¯ä»¥åœ¨æ˜¾ç¤ºå…³äºçª—å£å’Œé…ç½®çª—å£æ—¶ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„é€»è¾‘ã€‚\nåœ¨ç”¨æˆ·è¦æ±‚é€€å‡ºåº”ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å¤„ç†å™¨æ¥æ¥å—æˆ–æ‹’ç»é€€å‡ºè¯·æ±‚ã€‚åœ¨ AWT å›¾åƒæ”¯æŒæ–¹é¢ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨å¤šåˆ†è¾¨ç‡å›¾åƒã€‚\nç»Ÿä¸€ JVM æ—¥å¿— Java 9 ä¸­ ï¼ŒJVM æœ‰äº†ç»Ÿä¸€çš„æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨æ–°çš„å‘½ä»¤è¡Œé€‰é¡¹ -Xlog æ¥æ§åˆ¶ JVM ä¸Š æ‰€æœ‰ç»„ä»¶çš„æ—¥å¿—è®°å½•ã€‚è¯¥æ—¥å¿—è®°å½•ç³»ç»Ÿå¯ä»¥è®¾ç½®è¾“å‡ºçš„æ—¥å¿—æ¶ˆæ¯çš„æ ‡ç­¾ã€çº§åˆ«ã€ä¿®é¥°ç¬¦å’Œè¾“å‡ºç›®æ ‡ç­‰ã€‚\nJava 9 ç§»é™¤äº†åœ¨ Java 8 ä¸­ è¢«åºŸå¼ƒçš„åƒåœ¾å›æ”¶å™¨é…ç½®ç»„åˆï¼ŒåŒæ—¶ æŠŠ G1 è®¾ä¸ºé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨å®ç°ã€‚å¦å¤–ï¼ŒCMS åƒåœ¾å›æ”¶å™¨å·²ç»è¢«å£°æ˜ä¸ºåºŸå¼ƒã€‚Java 9 ä¹Ÿå¢åŠ äº†å¾ˆå¤šå¯ä»¥é€šè¿‡ jcmd è°ƒç”¨çš„è¯Šæ–­å‘½ä»¤ã€‚\nå…¶ä»–æ”¹åŠ¨æ–¹é¢ åœ¨ Java è¯­è¨€æœ¬èº«:\nJava 9 å…è®¸åœ¨æ¥å£ä¸­ä½¿ç”¨ç§æœ‰æ–¹æ³• åœ¨ try-with-resources è¯­å¥ä¸­å¯ä»¥ä½¿ç”¨ effectively-final å˜é‡ã€‚ ç±» java.lang.StackWalker å¯ ä»¥å¯¹çº¿ç¨‹çš„å †æ ˆè¿›è¡Œéå†ï¼Œå¹¶ä¸”æ”¯æŒè¿‡æ»¤å’Œå»¶è¿Ÿè®¿é—® Java 9 æŠŠå¯¹ Unicode çš„æ”¯æŒå‡çº§åˆ°äº† 8.0 ResourceBundle åŠ è½½å±æ€§æ–‡ä»¶çš„é»˜è®¤ç¼–ç ä» ISO-8859-1 æ”¹æˆäº† UTF-8ï¼Œä¸å†éœ€è¦ä½¿ç”¨ native2ascii å‘½ä»¤æ¥å¯¹å±æ€§æ–‡ä»¶è¿›è¡Œé¢å¤–å¤„ç† æ³¨è§£ @Deprecated ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œå¢åŠ äº† since å’Œ forRemoval ä¸¤ä¸ªå±æ€§ï¼Œå¯ä»¥åˆ†åˆ«æŒ‡å®šä¸€ä¸ªç¨‹åºå…ƒç´ è¢«åºŸå¼ƒçš„ç‰ˆæœ¬ï¼Œä»¥åŠæ˜¯å¦ä¼šåœ¨ä»Šåçš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤ åœ¨ä»£ç æ¸…å• 14 ä¸­ï¼ŒbuildMessage æ˜¯æ¥å£ SayHi ä¸­çš„ç§æœ‰æ–¹æ³•ï¼Œåœ¨é»˜è®¤æ–¹æ³• sayHi ä¸­è¢«ä½¿ç”¨ã€‚\næ¸…å• 14. æ¥å£ä¸­ç§æœ‰æ–¹æ³•çš„ç¤ºä¾‹\njava 1 2 3 4 5 6 7 8 9 10 11 public interface SayHi { private String buildMessage() { return \"Hello\"; } void sayHi(final String message); default void sayHi() { sayHi(buildMessage()); } } ","wordCount":"1320","inLanguage":"zh","datePublished":"2021-02-15T17:05:10+08:00","dateModified":"2021-02-15T17:05:10+08:00","author":{"@type":"Person","name":"tofuwine"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tofuwine.github.io/posts/df5b48f5/"},"publisher":{"@type":"Organization","name":"Tofuwine's Blog","logo":{"@type":"ImageObject","url":"https://tofuwine.github.io/images/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tofuwine.github.io/><img src=https://tofuwine.github.io/images/profile.png alt aria-label=logo height=35>Tofuwine's Blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://tofuwine.github.io/topics><span>ğŸ“‚ ä¸“é¢˜</span></a></li><li><a href=https://tofuwine.github.io/moments><span>ğŸŒŸ ç¬é—´</span></a></li><li><a href=https://tofuwine.github.io/archives><span>ğŸ—‚ï¸ å½’æ¡£</span></a></li><li><a href=https://tofuwine.github.io/friend><span>ğŸ¤ å‹é“¾</span></a></li><li><a href=https://tofuwine.github.io/search accesskey=/><span>ğŸ” æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tofuwine.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://tofuwine.github.io/topics/>ğŸ“‚ ä¸“é¢˜</a>&nbsp;Â»&nbsp;<a href=https://tofuwine.github.io/topics/programming/>ğŸ–¥ï¸ è®¡ç®—æœºç¼–ç¨‹æŠ€æœ¯</a></div><h1 class="post-title entry-hint-parent">Java 9 æ–°ç‰¹æ€§</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2021-02-15</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1320 å­—</span></span>&nbsp;Â·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>7 åˆ†é’Ÿ</span></span>
<span class=pe-post-meta-item>&nbsp;Â·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://tofuwine.github.io/tags/java/>#Java</a>
<a href=https://tofuwine.github.io/tags/new-feature/>#New Feature</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#java-%e5%b9%b3%e5%8f%b0%e6%a8%a1%e5%9d%97%e7%b3%bb%e7%bb%9f aria-label="Java å¹³å°æ¨¡å—ç³»ç»Ÿ">Java å¹³å°æ¨¡å—ç³»ç»Ÿ</a><li><a href=#jshell aria-label=Jshell>Jshell</a><li><a href=#%e9%9b%86%e5%90%88stream-%e5%92%8c-optional aria-label="é›†åˆã€Stream å’Œ Optional">é›†åˆã€Stream å’Œ Optional</a><li><a href=#%e8%bf%9b%e7%a8%8b-api aria-label="è¿›ç¨‹ API">è¿›ç¨‹ API</a><li><a href=#%e5%b9%b3%e5%8f%b0%e6%97%a5%e5%bf%97-api-%e5%92%8c-%e6%9c%8d%e5%8a%a1 aria-label="å¹³å°æ—¥å¿— API å’Œ æœåŠ¡">å¹³å°æ—¥å¿— API å’Œ æœåŠ¡</a><li><a href=#%e5%8f%8d%e5%ba%94%e5%bc%8f%e6%b5%81reactive-streams aria-label="ååº”å¼æµï¼ˆReactive Streamsï¼‰">ååº”å¼æµï¼ˆReactive Streamsï¼‰</a><li><a href=#%e5%8f%98%e9%87%8f%e5%8f%a5%e6%9f%84 aria-label=å˜é‡å¥æŸ„>å˜é‡å¥æŸ„</a><li><a href=#%e6%94%b9%e5%8f%98%e6%96%b9%e6%b3%95%e5%8f%a5%e6%9f%84method-handle aria-label="æ”¹å˜æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰">æ”¹å˜æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰</a><li><a href=#%e5%b9%b6%e5%8f%91 aria-label=å¹¶å‘>å¹¶å‘</a><li><a href=#nashorn aria-label=Nashorn>Nashorn</a><li><a href=#io-%e6%b5%81%e6%96%b0%e7%89%b9%e6%80%a7 aria-label="I/O æµæ–°ç‰¹æ€§">I/O æµæ–°ç‰¹æ€§</a><li><a href=#%e6%94%b9%e8%bf%9b%e5%ba%94%e7%94%a8%e5%ae%89%e5%85%a8%e6%80%a7%e8%83%bd aria-label=æ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½>æ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½</a><li><a href=#%e7%94%a8%e6%88%b7%e7%95%8c%e9%9d%a2 aria-label=ç”¨æˆ·ç•Œé¢>ç”¨æˆ·ç•Œé¢</a><li><a href=#%e7%bb%9f%e4%b8%80-jvm-%e6%97%a5%e5%bf%97 aria-label="ç»Ÿä¸€ JVM æ—¥å¿—">ç»Ÿä¸€ JVM æ—¥å¿—</a><li><a href=#%e5%85%b6%e4%bb%96%e6%94%b9%e5%8a%a8%e6%96%b9%e9%9d%a2 aria-label=å…¶ä»–æ”¹åŠ¨æ–¹é¢>å…¶ä»–æ”¹åŠ¨æ–¹é¢</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><div class="pe-tip warning"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>
æœ¬æ–‡æœ€åæ›´æ–°äº&nbsp;3 å¹´å‰&nbsp;ï¼Œæ–‡ä¸­ä¿¡æ¯å¯èƒ½å·²ç»è¿‡æ—¶ã€‚å¦‚æœ‰é—®é¢˜è¯·åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</div><p>Java 9 æ­£å¼å‘å¸ƒäº 2017 å¹´ 9 æœˆ 21 æ—¥ã€‚ä½œä¸º Java 8 ä¹‹å 3 å¹´åŠæ‰å‘å¸ƒçš„æ–°ç‰ˆæœ¬ï¼ŒJava 9 å¸¦æ¥äº†å¾ˆå¤šé‡å¤§çš„å˜åŒ–ã€‚å…¶ä¸­æœ€é‡è¦çš„æ”¹åŠ¨æ˜¯ Java å¹³å°æ¨¡å—ç³»ç»Ÿçš„å¼•å…¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–°ç‰¹æ€§ã€‚</p><h2 id=java-å¹³å°æ¨¡å—ç³»ç»Ÿ>Java å¹³å°æ¨¡å—ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#java-å¹³å°æ¨¡å—ç³»ç»Ÿ>#</a></h2><p>Java å¹³å°æ¨¡å—ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ <code>Project Jigsaw</code>ï¼ŒæŠŠæ¨¡å—åŒ–å¼€å‘å®è·µå¼•å…¥åˆ°äº† Java å¹³å°ä¸­ã€‚åœ¨å¼•å…¥äº†æ¨¡å—ç³»ç»Ÿä¹‹åï¼ŒJDK è¢«é‡æ–°ç»„ç»‡æˆ 94 ä¸ªæ¨¡å—ã€‚Java åº”ç”¨å¯ä»¥é€šè¿‡æ–°å¢çš„ jlink å·¥å…·ï¼Œåˆ›å»ºå‡ºåªåŒ…å«æ‰€ä¾èµ–çš„ JDK æ¨¡å—çš„è‡ªå®šä¹‰è¿è¡Œæ—¶é•œåƒã€‚è¿™æ ·å¯ä»¥æå¤§çš„å‡å°‘ Java è¿è¡Œæ—¶ç¯å¢ƒçš„å¤§å°ã€‚è¿™å¯¹äºç›®å‰æµè¡Œçš„ä¸å¯å˜åŸºç¡€è®¾æ–½çš„å®è·µæ¥è¯´ï¼Œé•œåƒçš„å¤§å°çš„å‡å°‘å¯ä»¥èŠ‚çœå¾ˆå¤šå­˜å‚¨ç©ºé—´å’Œå¸¦å®½èµ„æºã€‚</p><p>æ¨¡å—åŒ–å¼€å‘çš„å®è·µåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µã€‚Java å¼€å‘ç¤¾åŒºå·²ç»ä½¿ç”¨è¿™æ ·çš„æ¨¡å—åŒ–å®è·µæœ‰ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ã€‚ä¸»æµçš„æ„å»ºå·¥å…·ï¼ŒåŒ…æ‹¬ Apache Maven å’Œ Gradle éƒ½æ”¯æŒæŠŠä¸€ä¸ªå¤§çš„é¡¹ç›®åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­é¡¹ç›®ã€‚å­é¡¹ç›®ä¹‹é—´é€šè¿‡ä¸åŒçš„ä¾èµ–å…³ç³»ç»„ç»‡åœ¨ä¸€èµ·ã€‚æ¯ä¸ªå­é¡¹ç›®åœ¨æ„å»ºä¹‹åéƒ½ä¼šäº§ç”Ÿå¯¹åº”çš„ JAR æ–‡ä»¶ã€‚åœ¨ Java 9 ä¸­ï¼Œå·²æœ‰çš„è¿™äº›é¡¹ç›®å¯ä»¥å¾ˆå®¹æ˜“çš„å‡çº§è½¬æ¢ä¸º Java 9 æ¨¡å—ï¼Œå¹¶ä¿æŒåŸæœ‰çš„ç»„ç»‡ç»“æ„ä¸å˜ã€‚</p><p>Java 9 æ¨¡å—çš„é‡è¦ç‰¹å¾æ˜¯åœ¨å…¶å·¥ä½œï¼ˆartifactï¼‰çš„æ ¹ç›®å½•ä¸­åŒ…å«ä¸€ä¸ªæè¿°æ¨¡å—çš„ <code>module-info.class</code> æ–‡ä»¶ã€‚å·¥ä»¶çš„æ ¼å¼å¯ä»¥æ˜¯ä¼ ç»Ÿçš„ JAR æ–‡ä»¶æˆ–æ˜¯ Java 9 æ–°å¢çš„ JMOD æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”±æ ¹ç›®å½•ä¸­çš„æºä»£ç æ–‡ä»¶ <code>module-info.java</code> ç¼–è¯‘è€Œæ¥ã€‚è¯¥æ¨¡å—å£°æ˜æ–‡ä»¶å¯ä»¥æè¿°æ¨¡å—çš„ä¸åŒç‰¹å¾ã€‚æ¨¡å—å£°æ˜æ–‡ä»¶ä¸­å¯ä»¥åŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š</p><ul><li>æ¨¡å—å¯¼å‡ºçš„åŒ…ï¼šä½¿ç”¨ <code>exports</code> å¯ä»¥å£°æ˜æ¨¡å—å¯¹å…¶ä»–æ¨¡å—æ‰€å¯¼å‡ºçš„åŒ…ã€‚åŒ…ä¸­çš„ <code>public</code> å’Œ <code>protected</code> ç±»å‹ï¼Œä»¥åŠè¿™äº›ç±»å‹çš„ public å’Œ protected æˆå‘˜å¯ä»¥è¢«å…¶ä»–æ¨¡å—æ‰€è®¿é—®ã€‚æ²¡æœ‰å£°æ˜ä¸ºå¯¼å‡ºçš„åŒ…ç›¸å½“äºæ¨¡å—ä¸­çš„ç§æœ‰æˆå‘˜ï¼Œä¸èƒ½è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚</li><li>æ¨¡å—çš„ä¾èµ–å…³ç³»ï¼šä½¿ç”¨ <code>requires</code> å¯ä»¥å£°æ˜æ¨¡å—å¯¹å…¶ä»–æ¨¡å—çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨ <code>requires transitive</code> å¯ä»¥æŠŠä¸€ä¸ªæ¨¡å—ä¾èµ–å£°æ˜ä¸ºä¼ é€’çš„ã€‚ä¼ é€’çš„æ¨¡å—ä¾èµ–å¯ä»¥è¢«ä¾èµ–å½“å‰æ¨¡å—çš„å…¶ä»–æ¨¡å—æ‰€è¯»å–ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—æ‰€å¯¼å‡ºçš„ç±»å‹çš„å‹æ„ä¸­åŒ…å«äº†æ¥è‡ªå®ƒæ‰€ä¾èµ–çš„æ¨¡å—çš„ç±»å‹ï¼Œé‚£ä¹ˆå¯¹è¯¥æ¨¡å—çš„ä¾èµ–åº”è¯¥å£°æ˜ä¸ºä¼ é€’çš„ã€‚</li><li>æœåŠ¡çš„æä¾›å’Œä½¿ç”¨ï¼šå¦‚æœä¸€ä¸ªæ¨¡å—ä¸­åŒ…å«äº†å¯ä»¥è¢« ServiceLocator å‘ç°çš„æœåŠ¡æ¥å£çš„å®ç°ï¼Œéœ€è¦ä½¿ç”¨ provides with è¯­å¥æ¥å£°æ˜å…·ä½“çš„å®ç°ç±»ï¼›å¦‚æœä¸€ä¸ªæ¨¡å—éœ€è¦ä½¿ç”¨æœåŠ¡æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ uses è¯­å¥æ¥å£°æ˜ã€‚</li></ul><p>ä»£ç æ¸…å• 1 ä¸­ç»™å‡ºäº†ä¸€ä¸ªæ¨¡å—å£°æ˜æ–‡ä»¶çš„ç¤ºä¾‹ã€‚åœ¨è¯¥å£°æ˜æ–‡ä»¶ä¸­ï¼Œæ¨¡å— <code>com.mycompany.sample</code> å¯¼å‡ºäº† Java åŒ… <code>com.mycompany.sample</code>ã€‚è¯¥æ¨¡å—ä¾èµ–äºæ¨¡å— <code>com.mycompany.common</code>ã€‚è¯¥æ¨¡å—ä¹Ÿæä¾›äº†æœåŠ¡æ¥å£ <code>com.mycompany.common.DemoService</code> çš„å®ç°ç±» <code>com.mycompany.sample.DemoServiceImpl</code>ã€‚</p><p><strong>æ¸…å•1. æ¨¡å—å£°æ˜ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span>module-info.java</span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>module</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>mycompany</span><span class=p>.</span><span class=na>sample</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>exports</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>mycompany</span><span class=p>.</span><span class=na>sample</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requires</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>mycompany</span><span class=p>.</span><span class=na>common</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>provides</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>mycompany</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>DemoService</span><span class=w> </span><span class=n>with</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>mycompany</span><span class=p>.</span><span class=na>sample</span><span class=p>.</span><span class=na>DemoServiceImpl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>æ¨¡å—ç³»ç»Ÿä¸­å¢åŠ äº†æ¨¡å—è·¯å¾„çš„æ¦‚å¿µã€‚æ¨¡å—ç³»ç»Ÿåœ¨è§£ææ¨¡å—æ—¶ï¼Œä¼šä»æ¨¡å—è·¯å¾„ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ä¸ºäº†ä¿æŒä¸ä¹‹å‰ Java ç‰ˆæœ¬çš„å…¼å®¹æ€§ï¼ŒCLASSPATH ä¾ç„¶ä¿ç•™ã€‚æ‰€æœ‰çš„ç±»å‹åœ¨è¿è¡Œæ—¶éƒ½å±äºæŸä¸ªç‰¹å®šçš„æ¨¡å—ã€‚å¯¹äº CLASSPATH ä¸­åŠ è½½çš„ç±»å‹ï¼Œå®ƒä»¬å±äºå®ƒä»¬çš„ç±»åŠ è½½å™¨å¯¹åº”çš„æœªå‘½åæ¨¡å—ã€‚å¯ä»¥é€šè¿‡ Class çš„ <code>getModule()</code> æ–¹æ³•æ¥è·å–åˆ°è¡¨ç¤ºå…¶æ‰€åœ¨æ¨¡å—çš„ Module å¯¹è±¡ã€‚</p><p>åœ¨ JVM å¯åŠ¨æ—¶ï¼Œä¼šä»åº”ç”¨çš„æ ¹æ¨¡å—å¼€å§‹ï¼Œæ ¹æ®ä¾èµ–å…³ç³»é€’å½’çš„è¿›è¡Œè§£æï¼Œç›´åˆ°å¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºä¾èµ–å…³ç³»çš„å›¾ã€‚å¦‚æœè§£æè¿‡ç¨‹ä¸­å‡ºç°æ‰¾ä¸åˆ°æ¨¡å—çš„æƒ…å†µï¼Œæˆ–æ˜¯åœ¨æ¨¡å—è·¯å¾„çš„åŒä¸€ä¸ªåœ°æ–¹æ‰¾åˆ°äº†åç§°ç›¸åŒçš„æ¨¡å—ï¼Œæ¨¡å—è§£æè¿‡ç¨‹ä¼šç»ˆæ­¢ï¼ŒJVM ä¹Ÿä¼šé€€å‡ºã€‚Java ä¹Ÿæä¾›äº†å“åº”çš„ API ä¸æ¨¡å—ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚</p><h2 id=jshell>Jshell<a hidden class=anchor aria-hidden=true href=#jshell>#</a></h2><p>jshell æ˜¯ Java 9 æ–°å¢çš„ä¸€ä¸ªå®ç”¨å·¥å…·ã€‚jshell ä¸º Java å¢åŠ äº†ç±»ä¼¼ NodeJS å’Œ Python ä¸­è¯»å€¼-æ±‚å€¼-æ‰“å°å¾ªç¯ï¼ˆRead - Evaluation - Print Loopï¼‰ã€‚</p><p>åœ¨ jshell ä¸­å¯ä»¥ç›´æ¥è¾“å…¥è¡¨è¾¾å¼å¹¶æŸ¥çœ‹æ‰§è¡Œç»“æœã€‚å½“éœ€è¦æµ‹è¯•ä¸€ä¸ªæ–¹æ³•çš„è¿è¡Œç»“æœï¼Œæˆ–æ˜¯å¿«é€Ÿçš„å¯¹è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼æ—¶ï¼Œjshell éƒ½éå¸¸å®ç”¨ã€‚</p><p>åªéœ€è¦é€šè¿‡ <code>jshell</code> å‘½ä»¤å¯åŠ¨ jshellï¼Œç„¶åç›´æ¥è¾“å…¥è¡¨è¾¾å¼å³å¯ã€‚æ¯ä¸ªè¡¨è¾¾å¼çš„ç»“æœéƒ½ä¼šè¢«è‡ªåŠ¨ä¿å­˜ä¸‹æ¥ï¼Œä»¥æ•°å­—ç¼–å·ä½œä¸ºå¼•ç”¨ï¼Œç±»ä¼¼ <code>$1</code> å’Œ <code>$2</code> è¿™æ ·çš„åç§°ã€‚
å¯ä»¥åœ¨åç»­çš„è¡¨è¾¾å¼ä¸­å¼•ç”¨ä¹‹å‰è¯­å¥çš„è¿è¡Œç»“æœã€‚</p><p>åœ¨ jshell ä¸­ï¼Œé™¤äº†è¡¨è¾¾å¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ›å»º Java ç±»å’Œæ–¹æ³•ã€‚jshell ä¹Ÿæœ‰åŸºæœ¬çš„ä»£ç å®ŒæˆåŠŸèƒ½ã€‚</p><p>åœ¨ä»£ç æ¸…å•2ä¸­ï¼Œç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªæ–¹æ³• addã€‚</p><p><strong>æ¸…å•2. åœ¨ jshell ä¸­æ·»åŠ æ–¹æ³•</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>jshell</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>jshell&gt; int add<span class=o>(</span>int x, int y<span class=o>)</span> <span class=o>{</span>  ...&gt; <span class=k>return</span> x + y<span class=p>;</span>  ...&gt; <span class=o>}</span>  <span class=p>|</span> created method add<span class=o>(</span>int, int<span class=o>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p>æ¥ç€å°±å¯ä»¥åœ¨ jshell ä¸­ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚ä»£ç æ¸…å•3æ‰€ç¤ºï¼š</p><p><strong>æ¸…å•3. åœ¨ jshell ä¸­ä½¿ç”¨åˆ›å»ºçš„æ–¹æ³•</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>jshell</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>jshell&gt; add<span class=o>(</span>1, 2<span class=o>)</span> <span class=nv>$19</span> <span class=o>==</span>&gt; <span class=m>3</span></span></span></code></pre></td></tr></table></div></div></div></div><div class=pe-tip>è¾“å…¥ <code>/exit</code> å¯ä»¥é€€å‡º jshellã€‚</div><h2 id=é›†åˆstream-å’Œ-optional>é›†åˆã€Stream å’Œ Optional<a hidden class=anchor aria-hidden=true href=#é›†åˆstream-å’Œ-optional>#</a></h2><p>åœ¨é›†åˆä¸Šï¼ŒJava 9 å¢åŠ äº† <code>List.of()</code>ã€<code>Set.of()</code>ã€<code>Map.of()</code> å’Œ <code>Map.ofEntries()</code> ç­‰å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸å¯å˜é›†åˆï¼Œå¦‚ ä»£ç æ¸…å• 4 æ‰€ç¤ºã€‚</p><p><strong>æ¸…å•4. åˆ›å»ºä¸å¯å˜é›†åˆ</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;World&#34;</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;World&#34;</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;World&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><p>Stream ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³• <code>ofNullable</code>ã€<code>dropWhile</code>ã€<code>takeWhile</code> å’Œ <code>iterate</code>ã€‚åœ¨ ä»£ç æ¸…å• 5 ä¸­ï¼Œæµä¸­åŒ…å«äº†ä» 1 åˆ° 5 çš„å…ƒç´ ã€‚æ–­è¨€æ£€æŸ¥å…ƒç´ æ˜¯å¦ä¸ºå¥‡æ•°ã€‚ç¬¬ä¸€ä¸ªå…ƒç´  1 è¢«åˆ é™¤ï¼Œç»“æœæµä¸­åŒ…å« 4 ä¸ªå…ƒç´ ã€‚</p><p><strong>æ¸…å•5. Stream ä¸­çš„ dropWhile æ–¹æ³•ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testDropWhile</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>dropWhile</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>count</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>Collectors ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³• <code>filtering</code> å’Œ <code>flatMapping</code>ã€‚åœ¨ ä»£ç æ¸…å•6 ä¸­ï¼Œå¯¹äºè¾“å…¥çš„ String æµï¼Œå…ˆé€šè¿‡ <code>flatMapping</code> æŠŠ String æ˜ å°„æˆ Integer æµï¼Œå†æŠŠæ‰€æœ‰çš„ Integer æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚</p><p><strong>æ¸…å•6. Collectors çš„ flatMapping æ–¹æ³•ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testFlatMapping</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> 	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ab&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;abc&#34;</span><span class=p>)</span><span class=w>  			
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>flatMapping</span><span class=p>(</span><span class=n>v</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=na>chars</span><span class=p>().</span><span class=na>boxed</span><span class=p>(),</span><span class=w> </span><span class=n>Collectors</span><span class=p>.</span><span class=na>toSet</span><span class=p>()));</span><span class=w>  	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>Optional ç±»ä¸­æ–°å¢äº† <code>ifPresentOrElse</code>ã€<code>or</code> å’Œ <code>stream</code> ç­‰æ–¹æ³•ã€‚åœ¨ ä»£ç æ¸…å• 7 ä¸­ï¼ŒOptional æµä¸­åŒ…å« 3 ä¸ªå…ƒç´ ï¼Œå…¶ä¸­åªæœ‰ 2 ä¸ªæœ‰å€¼ã€‚åœ¨ä½¿ç”¨ <code>flatMap</code> ä¹‹åï¼Œç»“æœæµä¸­åŒ…å«äº† 2 ä¸ªå€¼ã€‚</p><p><strong>æ¸…å• 7. Optional çš„ stream æ–¹æ³•ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testStream</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>  	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=p>.</span><span class=na>empty</span><span class=p>(),</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>).</span><span class=na>flatMap</span><span class=p>(</span><span class=n>Optional</span><span class=p>::</span><span class=n>stream</span><span class=p>)</span><span class=w>  		
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>  	
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>count</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=è¿›ç¨‹-api>è¿›ç¨‹ API<a hidden class=anchor aria-hidden=true href=#è¿›ç¨‹-api>#</a></h2><p>Java 9 å¢åŠ äº† <code>ProcessHandle</code> æ¥å£ï¼Œå¯ä»¥å¯¹åŸç”Ÿè¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œå°¤å…¶é€‚åˆäºç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ã€‚</p><p>åœ¨ä½¿ç”¨ <code>ProcessBuilder</code> æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>Process.toHandle()</code> æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ª <code>ProcessHandle</code> å¯¹è±¡å®ä¾‹ã€‚
é€šè¿‡ <code>ProcessHandle</code> å¯ä»¥è·å–åˆ°ç”± <code>ProcessHandle.Info</code> è¡¨ç¤ºçš„è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å‘½ä»¤è¡Œå‚æ•°ã€å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å’Œå¯åŠ¨æ—¶é—´ç­‰ã€‚
<code>ProcessHandle</code> çš„ <code>onExit()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>CompletableFuture</code> å¯¹è±¡ï¼Œå¯ä»¥åœ¨è¿›ç¨‹ç»“æŸæ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„åŠ¨ä½œã€‚<br>ä»£ç æ¸…å•8 ä¸­ç»™å‡ºäº†è¿›ç¨‹ API çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><p><strong>æ¸…å•8. è¿›ç¨‹ API ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>final</span><span class=w> </span><span class=n>ProcessBuilder</span><span class=w> </span><span class=n>processBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ProcessBuilder</span><span class=p>(</span><span class=s>&#34;top&#34;</span><span class=p>).</span><span class=na>inheritIO</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>final</span><span class=w> </span><span class=n>ProcessHandle</span><span class=w> </span><span class=n>processHandle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processBuilder</span><span class=p>.</span><span class=na>start</span><span class=p>().</span><span class=na>toHandle</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>processHandle</span><span class=p>.</span><span class=na>onExit</span><span class=p>().</span><span class=na>whenCompleteAsync</span><span class=p>((</span><span class=n>handle</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>throwable</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>handle</span><span class=p>.</span><span class=na>pid</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>throwable</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>});</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=å¹³å°æ—¥å¿—-api-å’Œ-æœåŠ¡>å¹³å°æ—¥å¿— API å’Œ æœåŠ¡<a hidden class=anchor aria-hidden=true href=#å¹³å°æ—¥å¿—-api-å’Œ-æœåŠ¡>#</a></h2><p>Java 9 å…è®¸ä¸º JDK å’Œåº”ç”¨é…ç½®åŒæ ·çš„æ—¥å¿—å®ç°ã€‚æ–°å¢çš„ <code>System.LoggerFinder</code> ç”¨æ¥ç®¡ç† JDK ä½¿ç”¨çš„æ—¥å¿—è®°å½•å™¨å®ç°ã€‚</p><p>JVM åœ¨è¿è¡Œæ—¶åªæœ‰ä¸€ä¸ªç³»ç»ŸèŒƒå›´çš„ <code>LoggerFinder</code> å®ä¾‹ã€‚<code>LoggerFinder</code> é€šè¿‡æœåŠ¡æŸ¥æ‰¾æœºåˆ¶æ¥åŠ è½½æ—¥å¿—è®°å½•å™¨å®ç°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJDK ä½¿ç”¨ <code>java.logging</code> æ¨¡å—ä¸­çš„ <code>java.util.logging</code> å®ç°ã€‚é€šè¿‡ <code>LoggerFinder</code> çš„ <code>getLogger()</code> æ–¹æ³•å°±å¯ä»¥è·å–åˆ°è¡¨ç¤ºæ—¥å¿—è®°å½•å™¨çš„ <code>System.Logger</code> å®ç°ã€‚
åº”ç”¨åŒæ ·å¯ä»¥ä½¿ç”¨ <code>System.Logger</code> æ¥è®°å½•æ—¥å¿—ã€‚è¿™æ ·å°±ä¿è¯äº† JDK å’Œåº”ç”¨ä½¿ç”¨åŒæ ·çš„æ—¥å¿—å®ç°ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ <code>System.LoggerFinder</code> å®ç°æ¥è®© JDK å’Œåº”ç”¨ä½¿ç”¨ SLF4J ç­‰å…¶ä»–æ—¥å¿—è®°å½•æ¡†æ¶ã€‚</p><p>ä»£ç æ¸…å•9 ä¸­ç»™å‡ºäº†å¹³å°æ—¥å¿— API çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><p><strong>æ¸…å• 9. ä½¿ç”¨å¹³å°æ—¥å¿— API</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.System.Logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.System.Logger.Level</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Main</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>LOGGER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=s>&#34;Main&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LOGGER</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>Level</span><span class=p>.</span><span class=na>INFO</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Run!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=ååº”å¼æµreactive-streams>ååº”å¼æµï¼ˆReactive Streamsï¼‰<a hidden class=anchor aria-hidden=true href=#ååº”å¼æµreactive-streams>#</a></h2><p>ååº”å¼ç¼–ç¨‹çš„æ€æƒ³æœ€è¿‘å¾—åˆ°äº†å¹¿æ³›çš„æµè¡Œã€‚åœ¨ Java å¹³å°ä¸Šæœ‰æµè¡Œçš„ååº”å¼åº“ <a href=https://github.com/ReactiveX/RxJava target=_blank rel="noopener nofollow noreferrer">RxJava</a> å’Œ <a href=https://github.com/reactor/reactor-core target=_blank rel="noopener nofollow noreferrer">Reactor</a>ã€‚</p><p>ååº”å¼æµè§„èŒƒçš„å‡ºå‘ç‚¹æ˜¯æä¾›ä¸€ä¸ªå¸¦éé˜»å¡è´Ÿå‹ï¼ˆnon-blocking backpressureï¼‰çš„å¼‚å¸¸æµå¤„ç†è§„èŒƒã€‚ååº”å¼æµè§„èŒƒçš„æ ¸å¿ƒæ¥å£å·²ç»æ·»åŠ åˆ°äº† Java 9 ä¸­çš„ <code>java.util.concurrent.Flow</code> ç±»ä¸­ã€‚</p><p>Flow ä¸­åŒ…å«äº† <code>Flow.Publisher</code>ã€<code>Flow.Subscriber</code>ã€<code>Flow.Subscription</code> å’Œ <code>Flow.Processor</code> ç­‰ 4 ä¸ªæ ¸å¿ƒæ¥å£ã€‚Java 9 è¿˜æä¾›äº† <code>SubmissionPublisher</code> ä½œä¸º <code>Flow.Publisher</code> çš„ä¸€ä¸ªå®ç°ã€‚</p><p>RxJava 2 å’Œ Reactor éƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ Flow ç±»çš„æ ¸å¿ƒæ¥å£è¿›è¡Œäº’æ“ä½œã€‚</p><h2 id=å˜é‡å¥æŸ„>å˜é‡å¥æŸ„<a hidden class=anchor aria-hidden=true href=#å˜é‡å¥æŸ„>#</a></h2><p>å˜é‡å¥æŸ„æ˜¯ä¸€ä¸ªå˜é‡æˆ–ä¸€ç»„å˜é‡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬é™æ€åŸŸï¼Œéé™æ€åŸŸï¼Œæ•°ç»„å…ƒç´ å’Œå †å¤–æ•°æ®ç»“æ„ä¸­çš„ç»„æˆéƒ¨åˆ†ç­‰ã€‚å˜é‡å¥æŸ„çš„å«ä¹‰ç±»ä¼¼äºå·²æœ‰çš„æ–¹æ³•å¥æŸ„ã€‚</p><p>å˜é‡å¥æŸ„ç”± Java ç±» <code>java.lang.invoke.VarHandle</code> æ¥è¡¨ç¤ºã€‚å¯ä»¥ä½¿ç”¨ç±» <code>java.lang.invoke.MethodHandles.Lookup</code> ä¸­é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»º <code>VarHandle</code> å¯¹è±¡ã€‚</p><p>é€šè¿‡å˜é‡å¥æŸ„ï¼Œå¯ä»¥åœ¨å˜é‡ä¸Šè¿›è¡Œå„ç§æ“ä½œã€‚è¿™äº›æ“ä½œç§°ä¸ºè®¿é—®æ¨¡å¼ã€‚ä¸åŒçš„è®¿é—®æ¨¡å¼å°¤å…¶åœ¨å†…å­˜æ’åºä¸Šçš„ä¸åŒè¯­ä¹‰ã€‚</p><p>ç›®å‰ä¸€å…±æœ‰ 31 ç§è®¿é—®æ¨¡å¼ï¼Œè€Œæ¯ç§è®¿é—®æ¨¡å¼éƒ½åœ¨ <code>VarHandle</code> ä¸­æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¯¹å˜é‡è¿›è¡Œè¯»å–ã€å†™å…¥ã€åŸå­æ›´æ–°ã€æ•°å€¼åŸå­æ›´æ–°å’Œæ¯”ç‰¹ä½åŸå­æ“ä½œç­‰ã€‚<code>VarHandle</code> è¿˜å¯ä»¥ç”¨æ¥è®¿é—®æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ ï¼Œä»¥åŠæŠŠ <code>byte[]</code> æ•°ç»„å’Œ <code>ByteBuffer</code> å½“æˆæ˜¯ä¸åŒåŸå§‹ç±»å‹çš„æ•°ç»„æ¥è®¿é—®ã€‚</p><p>åœ¨ ä»£ç æ¸…å•10 ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è®¿é—® <code>HandleTarget</code> ç±»ä¸­çš„åŸŸ <code>count</code> çš„å˜é‡å¥æŸ„ï¼Œå¹¶åœ¨å…¶ä¸Šè¿›è¡Œè¯»å–æ“ä½œã€‚</p><p><strong>æ¸…å• 10. å˜é‡å¥æŸ„ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.Before</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.invoke.MethodHandles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.invoke.VarHandle</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.junit.Assert.assertEquals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HandleTarget</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>VarHandleTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>HandleTarget</span><span class=w> </span><span class=n>handleTarget</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HandleTarget</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>VarHandle</span><span class=w> </span><span class=n>varHandle</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Before</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setUp</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>handleTarget</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HandleTarget</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>varHandle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodHandles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>lookup</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>findVarHandle</span><span class=p>(</span><span class=n>HandleTarget</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=s>&#34;count&#34;</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testGet</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>varHandle</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>handleTarget</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>varHandle</span><span class=p>.</span><span class=na>getVolatile</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>handleTarget</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>varHandle</span><span class=p>.</span><span class=na>getOpaque</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>handleTarget</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>varHandle</span><span class=p>.</span><span class=na>getAcquire</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>handleTarget</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=æ”¹å˜æ–¹æ³•å¥æŸ„method-handle>æ”¹å˜æ–¹æ³•å¥æŸ„ï¼ˆMethod Handleï¼‰<a hidden class=anchor aria-hidden=true href=#æ”¹å˜æ–¹æ³•å¥æŸ„method-handle>#</a></h2><p>ç±» <code>java.lang.invoke.MethodHandles</code> å¢åŠ äº†æ›´å¤šçš„é™æ€æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„æ–¹æ³•å¥æŸ„ã€‚</p><ul><li><code>arrayConstructor</code>ï¼šåˆ›å»ºæŒ‡å®šç±»å‹çš„æ•°ç»„</li><li><code>arrayLength</code>ï¼šè·å–æŒ‡å®šç±»å‹çš„æ•°ç»„çš„å¤§å°</li><li><code>varHandleInvoker</code> å’Œ <code>varHandleExactInvoker</code>ï¼šè°ƒç”¨ <code>VarHandle</code> ä¸­çš„è®¿é—®æ¨¡å¼æ–¹æ³•</li><li><code>zero</code>ï¼šè¿”å›ä¸€ä¸ªç±»å‹çš„é»˜è®¤å€¼</li><li><code>empty</code>ï¼šè¿”å› <code>MethodType</code> çš„è¿”å›å€¼ç±»å‹çš„é»˜è®¤å€¼</li><li><code>loop</code>ã€<code>countedLoop</code>ã€<code>iteratedLoop</code>ã€<code>whileLoop</code> å’Œ <code>doWhileLoop</code>ï¼šåˆ›å»ºä¸åŒç±»å‹çš„å¾ªç¯ï¼ŒåŒ…æ‹¬ <code>for</code> å¾ªç¯ã€<code>while</code> å¾ªç¯ å’Œ <code>do-while</code> å¾ªç¯ã€‚</li><li><code>tryFinally</code>ï¼šå¯¹æ–¹æ³•å¥æŸ„çš„è°ƒç”¨å°è£…åœ¨ <code>try-finally</code> è¯­å¥ä¸­ã€‚</li></ul><p>åœ¨ ä»£ç æ¸…å• 11 ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>iteratedLoop</code> æ¥åˆ›å»ºä¸€ä¸ªéå† <code>String</code> ç±»å‹è¿­ä»£å™¨çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶è®¡ç®—æ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦çš„æ€»å’Œã€‚</p><p><strong>æ¸…å• 11. å¾ªç¯æ–¹æ³•å¥æŸ„ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.invoke.MethodHandle</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.invoke.MethodHandles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.invoke.MethodType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Iterator</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.junit.Assert.assertEquals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>IteratedLoopTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>body</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>sum</span><span class=p>,</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=na>length</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testIteratedLoop</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>MethodHandle</span><span class=w> </span><span class=n>iterator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodHandles</span><span class=p>.</span><span class=na>constant</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Iterator</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;bc&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;def&#34;</span><span class=p>).</span><span class=na>iterator</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>MethodHandle</span><span class=w> </span><span class=n>init</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodHandles</span><span class=p>.</span><span class=na>zero</span><span class=p>(</span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>MethodHandle</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodHandles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>lookup</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>findStatic</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>IteratedLoopTest</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;body&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>MethodType</span><span class=p>.</span><span class=na>methodType</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>MethodHandle</span><span class=w> </span><span class=n>iteratedLoop</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MethodHandles</span><span class=p>.</span><span class=na>iteratedLoop</span><span class=p>(</span><span class=n>iterator</span><span class=p>,</span><span class=w> </span><span class=n>init</span><span class=p>,</span><span class=w> </span><span class=n>body</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>6</span><span class=p>,</span><span class=w> </span><span class=n>iteratedLoop</span><span class=p>.</span><span class=na>invoke</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=å¹¶å‘>å¹¶å‘<a hidden class=anchor aria-hidden=true href=#å¹¶å‘>#</a></h2><p>åœ¨å¹¶å‘æ–¹é¢ï¼Œç±» <code>CompletableFuture</code> ä¸­å¢åŠ äº†å‡ ä¸ªæ–°çš„æ–¹æ³•ã€‚</p><ul><li><code>completeAsync</code> ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥è·å–ç»“æœå¹¶å®Œæˆè¯¥ <code>CompletableFuture</code>ã€‚</li><li><code>orTimeout</code> åœ¨ <code>Completable Future</code> æ²¡æœ‰åœ¨ç»™å®šçš„è¶…æ—¶æ—¶é—´ä¹‹å‰å®Œæˆï¼Œä½¿ç”¨ <code>Timeout Exception</code> å¼‚å¸¸æ¥å®Œæˆ <code>CompletableFuture</code>ã€‚</li><li><code>completeOnTimeout</code> ä¸ <code>orTimeout</code> ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒåœ¨è¶…æ—¶æ—¶ä½¿ç”¨ç»™å®šçš„å€¼æ¥å®Œæˆ <code>Completable Future</code>ã€‚</li><li>æ–°çš„ <code>Thread.onSpinWait</code> æ–¹æ³•åœ¨å½“å‰çº¿ç¨‹éœ€è¦ä½¿ç”¨å¿™å¾ªç¯æ¥ç­‰å¾…æ—¶ï¼Œå¯ä»¥æé«˜ç­‰å¾…çš„æ•ˆç‡ã€‚</li></ul><h2 id=nashorn>Nashorn<a hidden class=anchor aria-hidden=true href=#nashorn>#</a></h2><div class=pe-tip>Nashorn æ˜¯ Java 8 ä¸­å¼•å…¥çš„æ–°çš„ JavaScript å¼•æ“ã€‚</div><p>Java 9 ä¸­çš„ Nashorn å·²ç»å®ç°äº†ä¸€äº› ECMAScript 6 è§„èŒƒä¸­çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ¨¡æ¿å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶å­—é¢é‡ã€è¿­ä»£å™¨ å’Œ for..of å¾ªç¯ å’Œ ç®­å¤´å‡½æ•° ç­‰ã€‚<br>Nashorn è¿˜æä¾›äº† API æŠŠ ECMAScript æºä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰ï¼Œå¯ä»¥ç”¨æ¥å¯¹ ECMAScript æºä»£ç è¿›è¡Œåˆ†æã€‚</p><h2 id=io-æµæ–°ç‰¹æ€§>I/O æµæ–°ç‰¹æ€§<a hidden class=anchor aria-hidden=true href=#io-æµæ–°ç‰¹æ€§>#</a></h2><p>ç±» <code>java.io.InputStream</code> ä¸­å¢åŠ äº†æ–°çš„æ–¹æ³•æ¥è¯»å–å’Œå¤åˆ¶ InputStream ä¸­åŒ…å«çš„æ•°æ®ã€‚</p><ul><li><code>readAllBytes</code>ï¼šè¯»å– <code>InputStream</code> ä¸­çš„æ‰€æœ‰å‰©ä½™å­—èŠ‚ã€‚</li><li><code>readNBytes</code>ï¼šä» <code>InputStream</code> ä¸­è¯»å–æŒ‡å®šæ•°é‡çš„å­—èŠ‚åˆ°æ•°ç»„ä¸­ã€‚</li><li><code>transferTo</code>ï¼šè¯»å– <code>InputStream</code> ä¸­çš„å…¨éƒ¨å­—èŠ‚å¹¶å†™å…¥åˆ°æŒ‡å®šçš„ <code>OutputStream</code> ä¸­ã€‚</li></ul><p>ä»£ç æ¸…å• 12 ä¸­ç»™å‡ºäº†è¿™äº›æ–°æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><p><strong>æ¸…å• 12. InputStream ä¸­çš„æ–°æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.Before</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.InputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.junit.Assert.assertEquals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TestInputStream</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>CONTENT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Before</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setUp</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TestInputStream</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;/input.text&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testReadAllBytes</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>inputStream</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>CONTENT</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testReadNBytes</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>5</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>inputStream</span><span class=p>.</span><span class=na>readNBytes</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>data</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testTransferTo</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>outputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>inputStream</span><span class=p>.</span><span class=na>transferTo</span><span class=p>(</span><span class=n>outputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>CONTENT</span><span class=p>,</span><span class=w> </span><span class=n>outputStream</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p><code>ObjectInputFilter</code> å¯ä»¥å¯¹ <code>ObjectInputStream</code> ä¸­åŒ…å«çš„å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œæ¥ç¡®ä¿å…¶ä¸­åŒ…å«çš„æ•°æ®æ˜¯åˆæ³•çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>ObjectInputSteam</code> çš„æ–¹æ³• <code>setObjectInputFilter</code> æ¥è®¾ç½®ã€‚<br><code>ObjectInputFilter</code> åœ¨è¿›è¡Œæ£€æŸ¥æ—¶ï¼Œå¯ä»¥æ£€æŸ¥å¦‚å¯¹è±¡å›¾çš„æœ€å¤§æ·±åº¦ã€å¯¹è±¡å¼•ç”¨çš„æœ€å¤§æ•°é‡ã€è¾“å…¥æµä¸­çš„æœ€å¤§å­—èŠ‚æ•°å’Œæ•°ç»„çš„æœ€å¤§é•¿åº¦ç­‰é™åˆ¶ï¼Œä¹Ÿå¯ä»¥åŒ…å«çš„ç±»çš„åç§°è¿›è¡Œé™åˆ¶ã€‚</p><h2 id=æ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½>æ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½<a hidden class=anchor aria-hidden=true href=#æ”¹è¿›åº”ç”¨å®‰å…¨æ€§èƒ½>#</a></h2><p>Java 9 æ–°å¢äº† 4 ä¸ª SHA-3 å“ˆå¸Œç®—æ³•ï¼ŒSHA3-224ã€SHA3-256ã€SHA3-384 å’Œ SHA3-512ã€‚å¦å¤–ä¹Ÿå¢åŠ äº†é€šè¿‡ <code>java.security.SecureRandom</code> ç”Ÿæˆä½¿ç”¨ DRBG ç®—æ³•çš„å¼ºéšæœºæ•°ã€‚</p><p>ä»£ç æ¸…å• 13 ä¸­ç»™å‡ºäº† SHA-3 å“ˆå¸Œç®—æ³•çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><p><strong>æ¸…å• 13. SHA-3 å“ˆå¸Œç®—æ³•ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.commons.codec.binary.Hex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.security.MessageDigest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.security.NoSuchAlgorithmException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SHA3</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>NoSuchAlgorithmException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>MessageDigest</span><span class=w> </span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MessageDigest</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;SHA3-224&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>digest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>instance</span><span class=p>.</span><span class=na>digest</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Hex</span><span class=p>.</span><span class=na>encodeHexString</span><span class=p>(</span><span class=n>digest</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=ç”¨æˆ·ç•Œé¢>ç”¨æˆ·ç•Œé¢<a hidden class=anchor aria-hidden=true href=#ç”¨æˆ·ç•Œé¢>#</a></h2><p>ç±» <code>java.awt.Desktop</code> å¢åŠ äº†æ–°çš„ä¸æ¡Œé¢è¿›è¡Œäº’åŠ¨çš„èƒ½åŠ›ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>addAppEventListener</code> æ–¹æ³•æ¥æ·»åŠ ä¸åŒåº”ç”¨äº‹ä»¶çš„ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬åº”ç”¨å˜ä¸ºå‰å°åº”ç”¨ã€åº”ç”¨éšè—æˆ–æ˜¾ç¤ºã€å±å¹•å’Œç³»ç»Ÿè¿›å…¥ä¼‘çœ ä¸å”¤é†’ã€ä»¥åŠ ç”¨æˆ·ä¼šè¯çš„å¼€å§‹å’Œç»ˆæ­¢ç­‰ã€‚è¿˜å¯ä»¥åœ¨æ˜¾ç¤ºå…³äºçª—å£å’Œé…ç½®çª—å£æ—¶ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„é€»è¾‘ã€‚</p><p>åœ¨ç”¨æˆ·è¦æ±‚é€€å‡ºåº”ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å¤„ç†å™¨æ¥æ¥å—æˆ–æ‹’ç»é€€å‡ºè¯·æ±‚ã€‚åœ¨ AWT å›¾åƒæ”¯æŒæ–¹é¢ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨å¤šåˆ†è¾¨ç‡å›¾åƒã€‚</p><h2 id=ç»Ÿä¸€-jvm-æ—¥å¿—>ç»Ÿä¸€ JVM æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€-jvm-æ—¥å¿—>#</a></h2><p>Java 9 ä¸­ ï¼ŒJVM æœ‰äº†ç»Ÿä¸€çš„æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨æ–°çš„å‘½ä»¤è¡Œé€‰é¡¹ <code>-Xlog</code> æ¥æ§åˆ¶ JVM ä¸Š æ‰€æœ‰ç»„ä»¶çš„æ—¥å¿—è®°å½•ã€‚è¯¥æ—¥å¿—è®°å½•ç³»ç»Ÿå¯ä»¥è®¾ç½®è¾“å‡ºçš„æ—¥å¿—æ¶ˆæ¯çš„æ ‡ç­¾ã€çº§åˆ«ã€ä¿®é¥°ç¬¦å’Œè¾“å‡ºç›®æ ‡ç­‰ã€‚</p><p>Java 9 ç§»é™¤äº†åœ¨ Java 8 ä¸­ è¢«åºŸå¼ƒçš„åƒåœ¾å›æ”¶å™¨é…ç½®ç»„åˆï¼ŒåŒæ—¶ æŠŠ G1 è®¾ä¸ºé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨å®ç°ã€‚å¦å¤–ï¼ŒCMS åƒåœ¾å›æ”¶å™¨å·²ç»è¢«å£°æ˜ä¸ºåºŸå¼ƒã€‚Java 9 ä¹Ÿå¢åŠ äº†å¾ˆå¤šå¯ä»¥é€šè¿‡ <code>jcmd</code> è°ƒç”¨çš„è¯Šæ–­å‘½ä»¤ã€‚</p><h2 id=å…¶ä»–æ”¹åŠ¨æ–¹é¢>å…¶ä»–æ”¹åŠ¨æ–¹é¢<a hidden class=anchor aria-hidden=true href=#å…¶ä»–æ”¹åŠ¨æ–¹é¢>#</a></h2><p>åœ¨ Java è¯­è¨€æœ¬èº«:</p><ul><li>Java 9 å…è®¸åœ¨æ¥å£ä¸­ä½¿ç”¨ç§æœ‰æ–¹æ³•</li><li>åœ¨ <code>try-with-resources</code> è¯­å¥ä¸­å¯ä»¥ä½¿ç”¨ <code>effectively-final</code> å˜é‡ã€‚</li><li>ç±» <code>java.lang.StackWalker</code> å¯ ä»¥å¯¹çº¿ç¨‹çš„å †æ ˆè¿›è¡Œéå†ï¼Œå¹¶ä¸”æ”¯æŒè¿‡æ»¤å’Œå»¶è¿Ÿè®¿é—®</li><li>Java 9 æŠŠå¯¹ Unicode çš„æ”¯æŒå‡çº§åˆ°äº† 8.0</li><li><code>ResourceBundle</code> åŠ è½½å±æ€§æ–‡ä»¶çš„é»˜è®¤ç¼–ç ä» <code>ISO-8859-1</code> æ”¹æˆäº† <code>UTF-8</code>ï¼Œä¸å†éœ€è¦ä½¿ç”¨ <code>native2ascii</code> å‘½ä»¤æ¥å¯¹å±æ€§æ–‡ä»¶è¿›è¡Œé¢å¤–å¤„ç†</li><li>æ³¨è§£ <code>@Deprecated</code> ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œå¢åŠ äº† <code>since</code> å’Œ <code>forRemoval</code> ä¸¤ä¸ªå±æ€§ï¼Œå¯ä»¥åˆ†åˆ«æŒ‡å®šä¸€ä¸ªç¨‹åºå…ƒç´ è¢«åºŸå¼ƒçš„ç‰ˆæœ¬ï¼Œä»¥åŠæ˜¯å¦ä¼šåœ¨ä»Šåçš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤</li></ul><p>åœ¨ä»£ç æ¸…å• 14 ä¸­ï¼Œ<code>buildMessage</code> æ˜¯æ¥å£ <code>SayHi</code> ä¸­çš„ç§æœ‰æ–¹æ³•ï¼Œåœ¨é»˜è®¤æ–¹æ³• <code>sayHi</code> ä¸­è¢«ä½¿ç”¨ã€‚</p><p><strong>æ¸…å• 14. æ¥å£ä¸­ç§æœ‰æ–¹æ³•çš„ç¤ºä¾‹</strong></p><div class="pe-code-block-wrap pe-code-details open"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-icon" aria-hidden=true></i>
<span>java</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class=pe-code-details-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>SayHi</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>buildMessage</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;Hello&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>sayHi</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sayHi</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sayHi</span><span class=p>(</span><span class=n>buildMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-reward-wrap><div class=pe-reward><div class=pe-reward-btn><a href=javascript:void(0); onclick='document.querySelector(".pe-reward-overlay").classList.remove("hidden")'><svg t="1715776042195" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="17691" width="20" height="20"><path d="M835.52 337.824a159.04 159.04.0 01124.544 59.52 155.904 155.904.0 0130.4 134.08l-80.896 341.632a157.952 157.952.0 01-56.224 87.68 160.544 160.544.0 01-98.688 33.952H166.72c-75.712.0-137.44-60.96-137.44-136.256v-363.84c0-75.296 61.76-136.288 137.44-136.288h80.704c50.176.0 71.232-12.48 85.792-36.544 10.368-17.12 17.472-41.376 23.04-76 1.728-10.656 2.88-19.392 5.408-38.72 11.712-90.944 21.888-124.736 62.528-155.168 25.504-19.072 56.768-25.984 90.72-20.992 64.672 9.504 115.936 43.52 145.824 97.6 23.36 42.272 32.64 95.584 27.904 154.24-1.056 12.832-2.752 25.888-5.12 38.912-.64 3.68-1.856 9.024-3.712 16.192h155.68zm-261.472 80 14.72-51.104c9.472-32.704 15.04-53.376 16.064-59.2 1.92-10.56 3.264-21.024 4.096-31.296 3.584-43.84-3.04-81.6-18.208-109.056-17.472-31.68-46.88-51.2-87.392-57.12-13.696-2.016-23.456.128-31.168 5.888-15.808 11.84-22.4 33.792-31.136 101.312-2.56 20.16-3.84 29.44-5.76 41.248-7.04 43.872-16.704 76.8-33.536 104.64-28.736 47.52-75.424 75.2-154.24 75.2H166.72c-31.744.0-57.44 25.376-57.44 56.224v363.872c0 30.88 25.696 56.256 57.44 56.256h587.904c17.824.0 35.424-6.08 49.344-16.96 13.856-10.848 23.68-26.24 27.712-43.104l80.896-341.6a75.904 75.904.0 00-14.944-65.6 79.04 79.04.0 00-62.144-29.6H574.08zm-212.8 205.984 97.28 72.64 242.24-209.28s16.224-13.888 30.4-3.008c4.256 3.264 9.12 12.512-1.856 27.008L476.416 789.024s-19.392 24.864-42.4-.288l-109.12-138.208s-12.96-18.688 3.264-29.92c5.44-3.744 17.888-9.6 33.12 3.2z" fill="currentcolor" p-id="17692"/></svg></div><div class="pe-reward-overlay hidden"><div class=pe-reward-qr-wrap><div class=pe-reward-img><a class=fancybox rel=group><img src=https://tofuwine.github.io/images/wechat_pay.jpg alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div class=pe-reward-img><a class=fancybox rel=group><img src=https://tofuwine.github.io/images/alipay.jpg alt=alipay></a><p>æ”¯ä»˜å®</p></div></div></div><p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¯·ä½œè€…å–æ¯å’–å•¡ï¼</p></div></div><script>document.querySelector(".pe-reward-overlay").addEventListener("click",e=>{e.target.classList.add("hidden")})</script><div class=pe-copyright><hr><blockquote><p>æœ¬æ–‡ä¸ºåŸåˆ›å†…å®¹ï¼Œç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ã€‚å¦‚éœ€è½¬è½½ï¼Œè¯·åœ¨æ–‡ç« ä¸­å£°æ˜æœ¬æ–‡æ ‡é¢˜åŠé“¾æ¥ã€‚</p><p>æ–‡ç« æ ‡é¢˜ï¼šJava 9 æ–°ç‰¹æ€§ â€”â€” tofuwine</p><p>æ–‡ç« é“¾æ¥ï¼š<a href=https://tofuwine.github.io/posts/df5b48f5/ target=_blank>https://tofuwine.github.io/posts/df5b48f5/</a></p><p>è®¸å¯åè®®ï¼š<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://tofuwine.github.io/tags/java/>Java</a></li><li><a href=https://tofuwine.github.io/tags/new-feature/>New Feature</a></li></ul><nav class=paginav><a class=next href=https://tofuwine.github.io/posts/f9e86e51/><span class=title>ä¸‹ä¸€ç¯‡</span><br><span>ç¬¬ä¸€ç«  è®¡ç®—æœºåŸºç¡€</span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title>æ¬¢è¿æ¥åˆ°è¯„è®ºåŒº</p><p class=pe-comments-subtitle>æ„Ÿè°¢æ‚¨çš„è€å¿ƒé˜…è¯»ï¼æ¥é€‰ä¸ªè¡¨æƒ…ï¼Œæˆ–è€…ç•™ä¸ªè¯„è®ºå§ï¼</p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"tofuwine/tofuwine.github.io","data-repo-id":"R_kgDOLz45lw","data-category":"Announcements","data-category-id":"DIC_kwDOLz45l84CfBDJ","data-mapping":"specific","data-term":"posts/df5b48f5","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2023-2024 <a href=https://tofuwine.github.io/>Tofuwine's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=#pe-comments class=pe-float-btn id=comments-link style=visibility:visible;opacity:1><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29.338 29.338" fill="currentcolor"><path d="M27.184 1.605H2.156C.967 1.605.0 2.572.0 3.76v17.572c0 1.188.967 2.155 2.156 2.155h13.543l5.057 3.777c.414.31.842.468 1.268.468.789.0 1.639-.602 1.637-1.923v-2.322h3.523c1.188.0 2.154-.967 2.154-2.155V3.76C29.338 2.572 28.371 1.605 27.184 1.605zM27.34 21.332c0 .085-.068.155-.154.155h-5.523v3.955l-5.297-3.956H2.156c-.086.0-.154-.07-.154-.155V3.759c0-.085.068-.155.154-.155v.001h25.029c.086.0.154.07.154.155L27.34 21.332zM5.505 10.792h4.334v4.333H5.505V10.792zm7 0h4.334v4.333h-4.334V10.792zm7 0h4.334v4.333h-4.334V10.792z"/></svg>
</a><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div></body></html>